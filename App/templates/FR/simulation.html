<!DOCTYPE html><html lang="fr"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Simulation de diffusion</title><link rel="icon" href="{{ url_for('static', filename='images/i1.png') }}" type="image/x-icon"><style>body{background:#111;color:#eee;font-family:Arial,sans-serif;margin:0;display:flex;justify-content:center;align-items:center;padding:2rem}#container{display:flex;flex-direction:column;background:#111;border:2px solid #444;border-radius:8px;overflow:hidden}#canvas-wrapper{background:#000;padding:1rem}#canvas{display:block;width:800px;height:400px;border:2px solid #444}#controls{display:grid;grid-template-columns:1fr 1fr;gap:1rem;padding:1rem;background:#222}#controls h2{grid-column:span 2;margin:0 0 .5rem}.control-group{display:flex;flex-direction:column}.control-group.full{grid-column:span 2}label{margin-bottom:.25rem;font-size:.9rem}input,select{padding:.3rem;background:#333;border:1px solid #555;color:#eee;border-radius:4px}button{padding:.5rem;background:#444;border:none;color:#eee;border-radius:4px;cursor:pointer}button:disabled{opacity:.5;cursor:default}</style></head><body><div id="container"><div id="canvas-wrapper"><canvas id="canvas"></canvas></div><div id="controls"><h2>Paramètres</h2><div class="control-group"><label for="compoundA">Composé A</label><select id="compoundA"><option>Eau</option><option>Propylène</option><option>Benzène</option><option>Éthanol</option><option>Toluène</option><option>Acétaldéhyde</option><option>Méthyléthylamine</option></select></div><div class="control-group"><label for="compoundB">Composé B</label><select id="compoundB"><option>Eau</option><option>Propylène</option><option>Benzène</option><option>Éthanol</option><option>Toluène</option><option>Acétaldéhyde</option><option>Méthyléthylamine</option></select></div><div class="control-group"><label for="temp">Température (K)</label><input id="temp" type="number" placeholder="Température (K)"></div><div class="control-group"><label for="fractionA">Fraction molaire A</label><input id="fractionA" type="number" step="0.1" placeholder="Fraction molaire A"></div><div class="control-group"><label for="totalParticles">Nombre de particules</label><input id="totalParticles" type="number" placeholder="Nombre de particules"></div><div class="control-group"><label for="particleSize">Taille des particules (px)</label><input id="particleSize" type="number" placeholder="Taille des particules"></div><div class="control-group"><label for="speedFactor">Vitesse (facteur)</label><input id="speedFactor" type="number" step="0.1" placeholder="Vitesse"></div><div class="control-group full"><button id="prepare">Préparer la simulation</button></div><div class="control-group"><button id="removeDivider" disabled="disabled">Rendre poreux</button></div><div class="control-group"><button id="start">▶️ Démarrer</button></div><div class="control-group"><button id="pause">⏸️ Pause</button></div></div></div><script>const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    canvas.width = canvas.clientWidth;
    canvas.height = canvas.clientHeight;

    let particles = [], animationId, running = false;
    let barrierActive = true;
    const dividerX = canvas.width / 2;

    class Particle {
      constructor(x,y,color){this.x=x;this.y=y;this.color=color;}
      step(speed){
        let nx=this.x+(Math.random()-0.5)*speed;
        let ny=this.y+(Math.random()-0.5)*speed;
        nx=Math.max(0,Math.min(nx,canvas.width));
        ny=Math.max(0,Math.min(ny,canvas.height));
        if(barrierActive){
          if((this.color==='red'&&nx>dividerX)||(this.color==='blue'&&nx<dividerX)){
            if(Math.random()<0.1){}else{nx=this.x;}
          }
        }
        this.x=nx; this.y=ny;
      }
      draw(size){
        ctx.fillStyle=this.color;
        ctx.beginPath();
        ctx.arc(this.x,this.y,size,0,Math.PI*2);
        ctx.fill();
      }
    }

    function drawDivider(){
      ctx.strokeStyle='lime';
      ctx.beginPath();
      ctx.moveTo(dividerX,0);
      ctx.lineTo(dividerX,canvas.height);
      ctx.stroke();
    }

    function prepareSimulation(){
      particles=[]; barrierActive=true;
      document.getElementById('removeDivider').disabled=false;
      const fracA=parseFloat(document.getElementById('fractionA').value);
      const total=parseInt(document.getElementById('totalParticles').value,10)||0;
      const countA=Math.round(total*fracA);
      for(let i=0;i<total;i++){
        const side=i<countA?'left':'right';
        const x=side==='left'
          ?Math.random()*(dividerX-5)
          :dividerX+Math.random()*(canvas.width-dividerX-5);
        const y=Math.random()*canvas.height;
        const color=i<countA?'red':'blue';
        particles.push(new Particle(x,y,color));
      }
      drawAll();
    }

    function drawAll(){
      const size=parseFloat(document.getElementById('particleSize').value)||3;
      ctx.clearRect(0,0,canvas.width,canvas.height);
      drawDivider();
      particles.forEach(p=>p.draw(size));
    }

    function animate(){
      const speed=parseFloat(document.getElementById('speedFactor').value)||4;
      particles.forEach(p=>p.step(speed));
      drawAll();
      animationId=requestAnimationFrame(animate);
    }

    document.getElementById('prepare').onclick=prepareSimulation;
    document.getElementById('removeDivider').onclick=()=>{
      barrierActive=false;
      document.getElementById('removeDivider').disabled=true;
    };
    document.getElementById('start').onclick=()=>{
      if(!running){running=true;animate();}
    };
    document.getElementById('pause').onclick=()=>{
      running=false;cancelAnimationFrame(animationId);
    };</script></body></html>